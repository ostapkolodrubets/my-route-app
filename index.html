<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Route AI - OSM</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.5/dist/leaflet.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
<style>
body { font-family: Arial; max-width: 600px; margin: 40px auto; }
input, button { width: 100%; padding: 12px; margin: 8px 0; }

#map-container {
  margin-top: 20px;
}
#map { 
  width: 100%; 
  height: 450px; 
  border-radius: 10px; 
}

#result {
  background-color: #fdfdfd;
  border-left: 5px solid #4CAF50;
  padding: 20px;
  margin-top: 20px;
  border-radius: 10px;
  box-shadow: 0 3px 10px rgba(0,0,0,0.1);
  font-family: 'Arial', sans-serif;
  line-height: 1.6;
  color: #333;
}

#result pre {
  white-space: pre-wrap;
  word-wrap: break-word;
  background: #f5f5f5;
  padding: 15px;
  border-radius: 8px;
  overflow-x: auto;
  margin-top: 10px;
  color: #444;
  font-family: 'Courier New', monospace;
  font-size: 14px;
}
</style>
</head>

<body>

<h2>Route Planner AI</h2>

<input id="start" placeholder="Enter start address" />
<input id="end" placeholder="Enter destination address" />

<button onclick="send()">Send to AI</button>

<div id="map-container">
  <div id="map"></div>
</div>

<div id="result"></div>

<script src="https://unpkg.com/leaflet@1.9.5/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>

<script>
// Ініціалізація карти
var map = L.map('map').setView([50.45, 30.523], 6); // Центр України
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

var control = null;

async function send() {
    const start = document.getElementById("start").value;
    const end = document.getElementById("end").value;

    if(!start || !end) {
        alert("Please enter both addresses!");
        return;
    }

    document.getElementById("result").innerText = "Loading route and AI recommendations...";

    const payload = { start_address: start, end_address: end };

    try {
        const res = await fetch("https://hook.eu2.make.com/y9ianrfc2521t2g4vl44z6vwpscwhq5l", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });

        const data = await res.json();
        console.log(data);

        // Очікуємо координати від AI
        // Формат:
        // {
        //   "start_coords": [lat, lon],
        //   "end_coords": [lat, lon],
        //   "advice": "Tolls, fuel, POI..."
        // }

        if(!data.start_coords || !data.end_coords) {
            document.getElementById("result").innerText = "AI did not return coordinates!";
            return;
        }

        // Видаляємо старий маршрут
        if(control) map.removeControl(control);

        // Створюємо маршрут через Leaflet Routing Machine
        control = L.Routing.control({
            waypoints: [
                L.latLng(data.start_coords[0], data.start_coords[1]),
                L.latLng(data.end_coords[0], data.end_coords[1])
            ],
            routeWhileDragging: false,
            show: true
        }).addTo(map);

        control.on('routesfound', function(e) {
            map.fitBounds(e.routes[0].bounds);
        });

        // Відображаємо поради AI
        document.getElementById("result").innerHTML = `<pre>${data.advice}</pre>`;

    } catch (err) {
        document.getElementById("result").innerText = "Error: " + err;
        console.error(err);
    }
}
</script>

</body>
</html>

